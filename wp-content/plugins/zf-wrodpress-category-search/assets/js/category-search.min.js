!function($){"use strict";function ZFCategorySearch(element,options){this.element=element,this.$elem=$(this.element),this.options=$.extend({},this.defaults,options),this.catType=$("#cat_type",this.element).val(),this.init()}ZFCategorySearch.prototype={defaults:{title:"",displayCatType:"tabs",tabPrevClass:"zf-control-prev",tabNextClass:"zf-control-next",tabAlignment:"",dropdownWidth:"200",dropdownPlaceholder:"Select category",dropdownSelectAllText:"All Categories",minumimCountSelected:0,showSubCategories:1,enableAutoSuggest:1,matchType:"+",limitSuggest:10},init:function(){var dropCat,ulCheckBox,subCategoriesText,strCats,iniSubcategories,slideW,count,total,prev,next,checkChildByID,$queries,$this=this,inputCat=$("#form-search",$this.element).find("#cats");0<inputCat.length&&("dropdown"==$this.options.displayCatType?(dropCat=$(".dropdown-categories",$this.element).multipleSelect({single:!1,selectAll:!0,width:"auto",minWidth:"180",maxHeight:"auto",filter:!1,displayValues:!1,minumimCountSelected:$this.options.minumimCountSelected,delimiter:", ",textTemplate:function($elm){return"<span></span>"+$elm.text()},placeholder:$this.options.dropdownPlaceholder,selectAllText:$this.options.selectAllText,onCheckAll:function(){inputCat.val("")},onUncheckAll:function(){inputCat.val("")},onClick:function(view){var vals=dropCat.multipleSelect("getSelects").join($this.options.matchType);inputCat.val(vals)}}),""!=inputCat.val()&&($queries=inputCat.val().split($this.options.matchType),dropCat.multipleSelect("setSelects",$queries))):(ulCheckBox=$(".checkbox-categories",$this.element),subCategoriesText=$(".subcategories-label",$this.element),strCats=inputCat.val(),iniSubcategories=function(){ulCheckBox.find('input[type="checkbox"]').on("change",function(){var $checkbox=$(this);$checkbox.is(":checked")?strCats+=$this.options.matchType+$checkbox.val():strCats=strCats.replace($this.options.matchType+$checkbox.val(),""),inputCat.val(strCats)})},"tabs"==$this.options.displayCatType?(total=count=slideW=0,$this.divWrapper=$(".tabs-wrapper",$this.element),$this.tabsNavigation=$("ul.tabs-navigation",$this.element),$this.wrapperW=$this.divWrapper.width(),$this.tabsNavigationH=$this.tabsNavigation.find("li.tab-nav").first().height()+26,$this.tabLeftStatus=!1,$this.tabRightStatus=!0,$this.tabsNavigation.find("li.tab-nav").each(function(){var liWidth=$(this).width()+70;slideW+=liWidth,$(this).attr("data-wd",liWidth)}),$this.sliderUlW=slideW,$this.sliderUlW>$this.wrapperW?($this.tabsNavigation.removeClass($this.options.tabAlignment),$this.divWrapper.attr("style",""),$this.tabsNavigation.css({width:$this.sliderUlW,height:$this.tabsNavigationH}),prev=$("<span/>",{class:$this.options.tabPrevClass+" zf-disabled"}),next=$("<span/>",{class:$this.options.tabNextClass}),prev.on("click",function(){return 0!=$this.tabLeftStatus&&(total+=parseInt($this.tabsNavigation.find("li").eq(count-1).attr("data-wd")),count--,void $this.moveLeft(prev,total,next))}),next.on("click",function(){return 0!=$this.tabRightStatus&&(total-=parseInt($this.tabsNavigation.find("li").eq(count).attr("data-wd")),count++,void $this.moveRight(prev,total,next))}),$this.divWrapper.prepend(next),$this.divWrapper.prepend(prev)):$this.divWrapper.attr("style","background: transparent !important"),$this.divWrapper.css({visibility:"visible"}),iniSubcategories(),$this.tabsNavigation.find("li.tab-nav").on("click",function(catSlug){if(catSlug.preventDefault(),$(this).hasClass("zf-current"))return!1;strCats="";var catID=$(this).attr("data-cat"),catSlug=$(this).attr("data-slug");$this.tabsNavigation.find("li.tab-nav").removeClass("zf-current"),$(this).addClass("zf-current"),checkChildByID(catID,catSlug)})):"radio"==$this.options.displayCatType&&(iniSubcategories(),$(".radio-categories",$this.element).find('input[name="radio"]').on("change",function(catSlug){catSlug.preventDefault(),strCats="";var catID=$(this).val(),catSlug=$(this).attr("data-slug");checkChildByID(catID,catSlug)})),checkChildByID=function(data,catSlug){subCategoriesText.hide(),ulCheckBox.empty(),""!=data?(inputCat.val(catSlug),strCats+=catSlug,data={action:"get_child_category_url",id:data,cat_type:$this.catType},1==$this.options.showSubCategories&&$.ajax({url:zfwcs_ajaxurl,type:"POST",data:data,beforeSend:function(){$(".zf-loading",$this.element).show()},success:function(data){""!=data?(ulCheckBox.append(data),iniSubcategories(),subCategoriesText.show()):ulCheckBox.empty(),$(".zf-loading",$this.element).hide()}})):(ulCheckBox.empty(),inputCat.val(""))})),1==$this.options.enableAutoSuggest&&(($queries=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,limit:$this.options.limitSuggest,remote:{url:zfwcs_ajaxurl+"?action=auto_suggest&",replace:function(url,query){return url+=$("#form-search",$this.element).serialize()},filter:function(items){return $.map(items,function(item){return{value:item.title}})},rateLimitWait:100}})).initialize(),$("#input-search",$this.element).typeahead(null,{name:"suggest-titles",displayKey:"value",source:$queries.ttAdapter()})),$this.advanced_box()},advanced_box:function(){var $this=this;$(".zf-chosen-multiple",$this.element).on("change",function(){var taxonomy=$(this).attr("data-taxonomy"),tax_val=$(this).val();console.log(tax_val);tax_val=$.isArray(tax_val)?tax_val.join($this.options.matchType):tax_val;$("#"+taxonomy,$this.element).val(tax_val)}),$(".zf-use-checkbox",$this.element).each(function(){var $_this=$(this),taxonomy_name=$_this.find(' > input[type="hidden"]');$_this.find('input[type="checkbox"]').on("change",function(){var temp=[];$_this.find('input[type="checkbox"]').each(function(){$(this).is(":checked")&&temp.push($(this).val())}),taxonomy_name.val(temp.join($this.options.matchType))})});var eminPrice,emaxPrice,spanFrom,spanTo,minPrice,maxPrice,currentMin,currentMax,priceSliderRange=$("#price-slider-range",$this.element);0<priceSliderRange.length&&(eminPrice=$("#min_price",$this.element),emaxPrice=$("#max_price",$this.element),spanFrom=$("span#from",$this.element),spanTo=$("span#to",$this.element),minPrice=eminPrice.data("minprice"),maxPrice=emaxPrice.data("maxprice"),currentMin=parseInt(eminPrice.val()),currentMax=parseInt(emaxPrice.val()),priceSliderRange.slider({range:!0,min:minPrice,max:maxPrice,values:[currentMin,currentMax],slide:function(event,ui){eminPrice.val(ui.values[0]),emaxPrice.val(ui.values[1]),spanFrom.html(ui.values[0]),spanTo.html(ui.values[1])},change:function(event,ui){}}));var dateFrom=$("#date_from",$this.element),dateTo=$("#date_to",$this.element);0<dateFrom.length&&(dateFrom.datepicker({defaultDate:"+1w",changeMonth:!1,dateFormat:"yy-mm-dd",onClose:function(selectDate){dateTo.datepicker("option","minDate",selectDate)}}),dateTo.datepicker({defaultDate:"+1w",changeMonth:!1,dateFormat:"yy-mm-dd",onClose:function(selectDate){dateFrom.datepicker("option","maxDate",selectDate)}}));var init_chosen=!1;$("a[data-popup-id]",$this.element).on("click",function(box){box.preventDefault();box=$(this).attr("data-popup-id");console.log(box),$("#"+box,$this.element).fadeIn(400,function(){}),init_chosen||($(".zf-chosen, .zf-chosen-full",$this.element).chosen({disable_search_threshold:10,disable_search:!0}),init_chosen=!0)}),$("#input-search, .advanced-popup-close",this.element).on("click",function(e){e.preventDefault(),$(".advanced-popup-box",this.element).fadeOut(500,function(){})})},moveLeft:function(prev,slideW,next){var $this=this;$this.tabsNavigation.animate({left:slideW},100,function(){0==slideW&&(prev.addClass("zf-disabled"),$this.tabLeftStatus=!1),next.removeClass("zf-disabled"),$this.tabRightStatus=!0})},moveRight:function(prev,slideW,next){var $this=this;$this.tabsNavigation.animate({left:slideW},100,function(){var ulSlideW=slideW+$this.sliderUlW;prev.removeClass("zf-disabled"),$this.tabLeftStatus=!0,ulSlideW<$this.wrapperW&&(next.addClass("zf-disabled"),$this.tabRightStatus=!1)})}},$.fn.zfcategorysearch=function(options){return this.each(function(){$(this);new ZFCategorySearch(this,options)})}}(jQuery);