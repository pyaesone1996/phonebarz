!function($){"use strict";function MultipleSelect($el,options){var that=this,name=$el.attr("name")||options.name||"";$el.parent().hide();var elWidth=$el.css("width");$el.parent().show(),"0px"==elWidth&&(elWidth=$el.outerWidth()+20),this.$el=$el.hide(),this.options=options,this.$parent=$("<div"+$.map(["class","title"],function(att){var attValue=that.$el.attr(att)||"";return(attValue=("class"===att?"ms-parent"+(attValue?" ":""):"")+attValue)?" "+att+'="'+attValue+'"':""}).join("")+" />"),this.$choice=$('<button type="button" class="ms-choice"><span class="placeholder">'+options.placeholder+"</span><div></div></button>"),this.$drop=$('<div class="ms-drop '+options.position+'"></div>'),this.$el.after(this.$parent),this.$parent.append(this.$choice),this.$parent.append(this.$drop),this.$el.prop("disabled")&&this.$choice.addClass("disabled"),this.$parent.css("width",options.width||elWidth),this.options.keepOpen||$("body").click(function(e){$(e.target)[0]!==that.$choice[0]&&$(e.target).parents(".ms-choice")[0]!==that.$choice[0]&&($(e.target)[0]!==that.$drop[0]&&$(e.target).parents(".ms-drop")[0]===that.$drop[0]||!that.options.isOpen||that.close())}),this.selectAllName='name="selectAll'+name+'"',this.selectGroupName='name="selectGroup'+name+'"',this.selectItemName='name="selectItem'+name+'"'}MultipleSelect.prototype={constructor:MultipleSelect,init:function(){var that=this,html=[];this.options.filter&&html.push('<div class="ms-search">','<input type="text" autocomplete="off" autocorrect="off" autocapitilize="off" spellcheck="false">',"</div>"),html.push("<ul>"),this.options.selectAll&&!this.options.single&&html.push('<li class="ms-select-all">','<input type="checkbox" '+this.selectAllName+" /> ","<label><span></span>",this.options.selectAllDelimiter[0]+this.options.selectAllText+this.options.selectAllDelimiter[1],"</label>","</li>"),$.each(this.$el.children(),function(i,elm){html.push(that.optionToHtml(i,elm))}),html.push('<li class="ms-no-results">'+this.options.noMatchesFound+"</li>"),html.push("</ul>"),this.$drop.html(html.join("")),this.$drop.find("ul").css("max-height",this.options.maxHeight+"px"),this.$drop.find(".multiple").css("width",this.options.multipleWidth+"px"),this.$searchInput=this.$drop.find(".ms-search input"),this.$selectAll=this.$drop.find("input["+this.selectAllName+"]"),this.$selectGroups=this.$drop.find("input["+this.selectGroupName+"]"),this.$selectItems=this.$drop.find("input["+this.selectItemName+"]:enabled"),this.$disableItems=this.$drop.find("input["+this.selectItemName+"]:disabled"),this.$noResults=this.$drop.find(".ms-no-results"),this.events(),this.updateSelectAll(!0),this.update(!0),this.options.isOpen&&this.open()},optionToHtml:function(label,style,group,groupDisabled){var value,text,selected,disabled,_group,that=this,$elm=$(style),html=[],multiple=this.options.multiple,clss=$.map(["class","title"],function(att,i){var isMultiple="class"===att&&multiple,attValue=$elm.attr(att)||"";return isMultiple||attValue?" "+att+'="'+(isMultiple?"multiple"+(attValue?" ":""):"")+attValue+'"':""}).join(""),type=this.options.single?"radio":"checkbox";return $elm.is("option")?(value=$elm.val(),text=that.options.textTemplate($elm),selected=null!=that.$el.attr("multiple")?$elm.prop("selected"):"selected"==$elm.attr("selected"),style=this.options.styler(value)?' style="'+this.options.styler(value)+'"':"",disabled=groupDisabled||$elm.prop("disabled"),""<this.options.blockSeparator&&this.options.blockSeparator==$elm.val()?html.push("<li"+clss+style+">",'<label class="'+this.options.blockSeparator+(disabled?"disabled":"")+'">',text,"</label>","</li>"):html.push("<li"+clss+style+">",'<input type="'+type+'" '+this.selectItemName+' value="'+value+'"'+(selected?' checked="checked"':"")+(disabled?' disabled="disabled"':"")+(group?' data-group="'+group+'"':"")+"/> ","<label"+(disabled?' class="disabled"':"")+">",text,"</label>","</li>")):!group&&$elm.is("optgroup")&&(_group="group_"+label,label=$elm.attr("label"),disabled=$elm.prop("disabled"),html.push('<li class="group">',this.options.hideOptgroupCheckboxes?"":'<input type="checkbox" '+this.selectGroupName+(disabled?' disabled="disabled"':"")+" /> ",'<label class="optgroup'+(disabled?" disabled":"")+'" data-group="'+_group+'">',label,"</label>","</li>"),$.each($elm.children(),function(i,elm){html.push(that.optionToHtml(i,elm,_group,disabled))})),html.join("")},events:function(){var that=this;function toggleOpen(e){e.preventDefault(),that[that.options.isOpen?"close":"open"]()}var label=this.$el.parent().closest("label")[0]||$("label[for="+this.$el.attr("id")+"]")[0];label&&$(label).off("click").on("click",function(e){"label"===e.target.nodeName.toLowerCase()&&e.target===this&&(toggleOpen(e),that.options.filter&&that.options.isOpen||that.focus(),e.stopPropagation())}),this.$choice.off("click").on("click",toggleOpen).off("focus").on("focus",this.options.onFocus).off("blur").on("blur",this.options.onBlur),this.$parent.off("keydown").on("keydown",function(e){27===e.which&&(that.close(),that.$choice.focus())}),this.$searchInput.off("keydown").on("keydown",function(e){9===e.keyCode&&e.shiftKey&&that.close()}).off("keyup").on("keyup",function(e){return that.options.filterAcceptOnEnter&&(13===e.which||32==e.which)&&that.$searchInput.val()?(that.$selectAll.click(),that.close(),void that.focus()):void that.filter()}),this.$selectAll.off("click").on("click",function(){var checked=$(this).prop("checked"),$items=that.$selectItems.filter(":visible");$items.length===that.$selectItems.length?that[checked?"checkAll":"uncheckAll"]():(that.$selectGroups.prop("checked",checked),$items.prop("checked",checked),that.options[checked?"onCheckAll":"onUncheckAll"](),that.update())}),this.$selectGroups.off("click").on("click",function(){var checked=$(this).parent().attr("data-group"),$children=that.$selectItems.filter(":visible").filter('[data-group="'+checked+'"]'),checked=$children.length!==$children.filter(":checked").length;$children.prop("checked",checked),that.updateSelectAll(),that.update(),that.options.onOptgroupClick({label:$(this).parent().text(),checked:checked,children:$children.get()})}),this.$selectItems.off("click").on("click",function(){that.updateSelectAll(),that.update(),that.updateOptGroupSelect(),that.options.onClick({label:$(this).parent().text(),value:$(this).val(),checked:$(this).prop("checked")}),that.options.single&&that.options.isOpen&&!that.options.keepOpen&&that.close()})},open:function(){var offset;this.$choice.hasClass("disabled")||(this.options.isOpen=!0,this.$choice.find(">div").addClass("open"),this.$drop.show(),this.$selectAll.parent().show(),this.$noResults.hide(),0===this.$el.children().length&&(this.$selectAll.parent().hide(),this.$noResults.show()),this.options.container&&(offset=this.$drop.offset(),this.$drop.appendTo($(this.options.container)),this.$drop.offset({top:offset.top,left:offset.left})),this.options.filter&&(this.$searchInput.val(""),this.$searchInput.focus(),this.filter()),this.options.onOpen())},close:function(){this.options.isOpen=!1,this.$choice.find(">div").removeClass("open"),this.$drop.hide(),this.options.container&&(this.$parent.append(this.$drop),this.$drop.css({top:"auto",left:"auto"})),this.options.onClose()},update:function(isInit){var selects=this.getSelects(),$span=this.$choice.find(">span");0===selects.length?$span.addClass("placeholder").html(this.options.placeholder):this.options.countSelected&&selects.length<this.options.minumimCountSelected?$span.removeClass("placeholder").html((this.options.displayValues?selects:this.getSelects("text")).join(this.options.delimiter)):this.options.allSelected&&selects.length===this.$selectItems.length+this.$disableItems.length?$span.removeClass("placeholder").html(this.options.allSelected):(this.options.countSelected||this.options.etcaetera)&&selects.length>this.options.minumimCountSelected?this.options.etcaetera?$span.removeClass("placeholder").html((this.options.displayValues?selects:this.getSelects("text").slice(0,this.options.minumimCountSelected)).join(this.options.delimiter)+"..."):$span.removeClass("placeholder").html(this.options.countSelected.replace("#",selects.length).replace("%",this.$selectItems.length+this.$disableItems.length)):$span.removeClass("placeholder").html((this.options.displayValues?selects:this.getSelects("text")).join(this.options.delimiter)),this.$el.val(this.getSelects()),this.$drop.find("li").removeClass("selected"),this.$drop.find("input["+this.selectItemName+"]:checked").each(function(){$(this).parents("li").first().addClass("selected")}),isInit||this.$el.trigger("change")},updateSelectAll:function(Init){var $items=this.$selectItems;Init||($items=$items.filter(":visible")),this.$selectAll.prop("checked",$items.length&&$items.length===$items.filter(":checked").length),this.$selectAll.prop("checked")&&this.options.onCheckAll()},updateOptGroupSelect:function(){var $items=this.$selectItems.filter(":visible");$.each(this.$selectGroups,function(i,val){var $children=$(val).parent().attr("data-group"),$children=$items.filter('[data-group="'+$children+'"]');$(val).prop("checked",$children.length&&$children.length===$children.filter(":checked").length)})},getSelects:function(type){var that=this,texts=[],values=[];return this.$drop.find("input["+this.selectItemName+"]:checked").each(function(){texts.push($(this).parents("li").first().text()),values.push($(this).val())}),"text"===type&&this.$selectGroups.length&&(texts=[],this.$selectGroups.each(function(){var list,html=[],text=$.trim($(this).parent().text()),$selected=$(this).parent().data("group"),$children=that.$drop.find("["+that.selectItemName+'][data-group="'+$selected+'"]'),$selected=$children.filter(":checked");0!==$selected.length&&(html.push("["),html.push(text),$children.length>$selected.length&&(list=[],$selected.each(function(){list.push($(this).parent().text())}),html.push(": "+list.join(", "))),html.push("]"),texts.push(html.join("")))})),"text"===type?texts:values},setSelects:function(values){var that=this;this.$selectItems.prop("checked",!1),$.each(values,function(i,value){that.$selectItems.filter('[value="'+value+'"]').prop("checked",!0)}),this.$selectAll.prop("checked",this.$selectItems.length===this.$selectItems.filter(":checked").length),this.update()},enable:function(){this.$choice.removeClass("disabled")},disable:function(){this.$choice.addClass("disabled")},checkAll:function(){this.$selectItems.prop("checked",!0),this.$selectGroups.prop("checked",!0),this.$selectAll.prop("checked",!0),this.update(),this.options.onCheckAll()},uncheckAll:function(){this.$selectItems.prop("checked",!1),this.$selectGroups.prop("checked",!1),this.$selectAll.prop("checked",!1),this.update(),this.options.onUncheckAll()},focus:function(){this.$choice.focus(),this.options.onFocus()},blur:function(){this.$choice.blur(),this.options.onBlur()},refresh:function(){this.init()},filter:function(){var that=this,text=$.trim(this.$searchInput.val()).toLowerCase();0===text.length?(this.$selectItems.parent().show(),this.$disableItems.parent().show(),this.$selectGroups.parent().show()):(this.$selectItems.each(function(){var $parent=$(this).parent();$parent[$parent.text().toLowerCase().indexOf(text)<0?"hide":"show"]()}),this.$disableItems.parent().hide(),this.$selectGroups.each(function(){var $parent=$(this).parent(),group=$parent.attr("data-group");$parent[0===that.$selectItems.filter(":visible").filter('[data-group="'+group+'"]').length?"hide":"show"]()}),this.$selectItems.filter(":visible").length?(this.$selectAll.parent().show(),this.$noResults.hide()):(this.$selectAll.parent().hide(),this.$noResults.show())),this.updateOptGroupSelect(),this.updateSelectAll()}},$.fn.multipleSelect=function(){var value,option=arguments[0],args=arguments,allowedMethods=["getSelects","setSelects","enable","disable","checkAll","uncheckAll","focus","blur","refresh"];return this.each(function(){var $this=$(this),data=$this.data("multipleSelect"),options=$.extend({},$.fn.multipleSelect.defaults,$this.data(),"object"==typeof option&&option);if(data||(data=new MultipleSelect($this,options),$this.data("multipleSelect",data)),"string"==typeof option){if($.inArray(option,allowedMethods)<0)throw"Unknown method: "+option;value=data[option](args[1])}else data.init(),args[1]&&(value=data[args[1]].apply(data,[].slice.call(args,2)))}),value||this},$.fn.multipleSelect.defaults={name:"",isOpen:!1,placeholder:"",selectAll:!0,selectAllText:"Select all",selectAllDelimiter:["[","]"],allSelected:"All selected",minumimCountSelected:3,countSelected:"# of % selected",noMatchesFound:"No matches found",multiple:!1,multipleWidth:80,single:!1,filter:!1,width:void 0,maxHeight:250,container:null,position:"bottom",keepOpen:!1,blockSeparator:"",displayValues:!1,delimiter:", ",styler:function(){return!1},textTemplate:function($elm){return $elm.text()},onOpen:function(){return!1},onClose:function(){return!1},onCheckAll:function(){return!1},onUncheckAll:function(){return!1},onFocus:function(){return!1},onBlur:function(){return!1},onOptgroupClick:function(){return!1},onClick:function(){return!1}}}(jQuery);