!function(t){"use strict";function e(e,s){var i=this,l=e.attr("name")||s.name||"";e.parent().hide();var o=e.css("width");e.parent().show(),"0px"==o&&(o=e.outerWidth()+20),this.$el=e.hide(),this.options=s,this.$parent=t("<div"+t.map(["class","title"],function(t){var e=i.$el.attr(t)||"";return(e=("class"===t?"ms-parent"+(e?" ":""):"")+e)?" "+t+'="'+e+'"':""}).join("")+" />"),this.$choice=t('<button type="button" class="ms-choice"><span class="placeholder">'+s.placeholder+"</span><div></div></button>"),this.$drop=t('<div class="ms-drop '+s.position+'"></div>'),this.$el.after(this.$parent),this.$parent.append(this.$choice),this.$parent.append(this.$drop),this.$el.prop("disabled")&&this.$choice.addClass("disabled"),this.$parent.css("width",s.width||o),this.options.keepOpen||t("body").click(function(e){t(e.target)[0]!==i.$choice[0]&&t(e.target).parents(".ms-choice")[0]!==i.$choice[0]&&(t(e.target)[0]!==i.$drop[0]&&t(e.target).parents(".ms-drop")[0]===i.$drop[0]||!i.options.isOpen||i.close())}),this.selectAllName='name="selectAll'+l+'"',this.selectGroupName='name="selectGroup'+l+'"',this.selectItemName='name="selectItem'+l+'"'}e.prototype={constructor:e,init:function(){var e=this,s=[];this.options.filter&&s.push('<div class="ms-search">','<input type="text" autocomplete="off" autocorrect="off" autocapitilize="off" spellcheck="false">',"</div>"),s.push("<ul>"),this.options.selectAll&&!this.options.single&&s.push('<li class="ms-select-all">','<input type="checkbox" '+this.selectAllName+" /> ","<label><span></span>",this.options.selectAllDelimiter[0]+this.options.selectAllText+this.options.selectAllDelimiter[1],"</label>","</li>"),t.each(this.$el.children(),function(t,i){s.push(e.optionToHtml(t,i))}),s.push('<li class="ms-no-results">'+this.options.noMatchesFound+"</li>"),s.push("</ul>"),this.$drop.html(s.join("")),this.$drop.find("ul").css("max-height",this.options.maxHeight+"px"),this.$drop.find(".multiple").css("width",this.options.multipleWidth+"px"),this.$searchInput=this.$drop.find(".ms-search input"),this.$selectAll=this.$drop.find("input["+this.selectAllName+"]"),this.$selectGroups=this.$drop.find("input["+this.selectGroupName+"]"),this.$selectItems=this.$drop.find("input["+this.selectItemName+"]:enabled"),this.$disableItems=this.$drop.find("input["+this.selectItemName+"]:disabled"),this.$noResults=this.$drop.find(".ms-no-results"),this.events(),this.updateSelectAll(!0),this.update(!0),this.options.isOpen&&this.open()},optionToHtml:function(g,$,i,l){var d,f,m,o,k,n=this,c=t($),h=[],p=this.options.multiple,r=t.map(["class","title"],function(t){var e="class"===t&&p,s=c.attr(t)||"";return e||s?" "+t+'="'+(e?"multiple"+(s?" ":""):"")+s+'"':""}).join(""),u=this.options.single?"radio":"checkbox";return c.is("option")?(d=c.val(),f=n.options.textTemplate(c),m=null!=n.$el.attr("multiple")?c.prop("selected"):"selected"==c.attr("selected"),$=this.options.styler(d)?' style="'+this.options.styler(d)+'"':"",o=l||c.prop("disabled"),""<this.options.blockSeparator&&this.options.blockSeparator==c.val()?h.push("<li"+r+$+">",'<label class="'+this.options.blockSeparator+(o?"disabled":"")+'">',f,"</label>","</li>"):h.push("<li"+r+$+">",'<input type="'+u+'" '+this.selectItemName+' value="'+d+'"'+(m?' checked="checked"':"")+(o?' disabled="disabled"':"")+(i?' data-group="'+i+'"':"")+"/> ","<label"+(o?' class="disabled"':"")+">",f,"</label>","</li>")):!i&&c.is("optgroup")&&(k="group_"+g,g=c.attr("label"),o=c.prop("disabled"),h.push('<li class="group">',this.options.hideOptgroupCheckboxes?"":'<input type="checkbox" '+this.selectGroupName+(o?' disabled="disabled"':"")+" /> ",'<label class="optgroup'+(o?" disabled":"")+'" data-group="'+k+'">',g,"</label>","</li>"),t.each(c.children(),function(t,e){h.push(n.optionToHtml(t,e,k,o))})),h.join("")},events:function(){function e(t){t.preventDefault(),s[s.options.isOpen?"close":"open"]()}var s=this,i=this.$el.parent().closest("label")[0]||t("label[for="+this.$el.attr("id")+"]")[0];i&&t(i).off("click").on("click",function(t){"label"===t.target.nodeName.toLowerCase()&&t.target===this&&(e(t),s.options.filter&&s.options.isOpen||s.focus(),t.stopPropagation())}),this.$choice.off("click").on("click",e).off("focus").on("focus",this.options.onFocus).off("blur").on("blur",this.options.onBlur),this.$parent.off("keydown").on("keydown",function(t){27===t.which&&(s.close(),s.$choice.focus())}),this.$searchInput.off("keydown").on("keydown",function(t){9===t.keyCode&&t.shiftKey&&s.close()}).off("keyup").on("keyup",function(t){return s.options.filterAcceptOnEnter&&(13===t.which||32==t.which)&&s.$searchInput.val()?(s.$selectAll.click(),s.close(),void s.focus()):void s.filter()}),this.$selectAll.off("click").on("click",function(){var e=t(this).prop("checked"),i=s.$selectItems.filter(":visible");i.length===s.$selectItems.length?s[e?"checkAll":"uncheckAll"]():(s.$selectGroups.prop("checked",e),i.prop("checked",e),s.options[e?"onCheckAll":"onUncheckAll"](),s.update())}),this.$selectGroups.off("click").on("click",function(){var o=t(this).parent().attr("data-group"),l=s.$selectItems.filter(":visible").filter('[data-group="'+o+'"]'),o=l.length!==l.filter(":checked").length;l.prop("checked",o),s.updateSelectAll(),s.update(),s.options.onOptgroupClick({label:t(this).parent().text(),checked:o,children:l.get()})}),this.$selectItems.off("click").on("click",function(){s.updateSelectAll(),s.update(),s.updateOptGroupSelect(),s.options.onClick({label:t(this).parent().text(),value:t(this).val(),checked:t(this).prop("checked")}),s.options.single&&s.options.isOpen&&!s.options.keepOpen&&s.close()})},open:function(){var e;this.$choice.hasClass("disabled")||(this.options.isOpen=!0,this.$choice.find(">div").addClass("open"),this.$drop.show(),this.$selectAll.parent().show(),this.$noResults.hide(),0===this.$el.children().length&&(this.$selectAll.parent().hide(),this.$noResults.show()),this.options.container&&(e=this.$drop.offset(),this.$drop.appendTo(t(this.options.container)),this.$drop.offset({top:e.top,left:e.left})),this.options.filter&&(this.$searchInput.val(""),this.$searchInput.focus(),this.filter()),this.options.onOpen())},close:function(){this.options.isOpen=!1,this.$choice.find(">div").removeClass("open"),this.$drop.hide(),this.options.container&&(this.$parent.append(this.$drop),this.$drop.css({top:"auto",left:"auto"})),this.options.onClose()},update:function(e){var s=this.getSelects(),i=this.$choice.find(">span");0===s.length?i.addClass("placeholder").html(this.options.placeholder):i.removeClass("placeholder").html(this.options.countSelected&&s.length<this.options.minumimCountSelected?(this.options.displayValues?s:this.getSelects("text")).join(this.options.delimiter):this.options.allSelected&&s.length===this.$selectItems.length+this.$disableItems.length?this.options.allSelected:(this.options.countSelected||this.options.etcaetera)&&s.length>this.options.minumimCountSelected?this.options.etcaetera?(this.options.displayValues?s:this.getSelects("text").slice(0,this.options.minumimCountSelected)).join(this.options.delimiter)+"...":this.options.countSelected.replace("#",s.length).replace("%",this.$selectItems.length+this.$disableItems.length):(this.options.displayValues?s:this.getSelects("text")).join(this.options.delimiter)),this.$el.val(this.getSelects()),this.$drop.find("li").removeClass("selected"),this.$drop.find("input["+this.selectItemName+"]:checked").each(function(){t(this).parents("li").first().addClass("selected")}),e||this.$el.trigger("change")},updateSelectAll:function(t){var e=this.$selectItems;t||(e=e.filter(":visible")),this.$selectAll.prop("checked",e.length&&e.length===e.filter(":checked").length),this.$selectAll.prop("checked")&&this.options.onCheckAll()},updateOptGroupSelect:function(){var e=this.$selectItems.filter(":visible");t.each(this.$selectGroups,function(s,i){var o=t(i).parent().attr("data-group"),o=e.filter('[data-group="'+o+'"]');t(i).prop("checked",o.length&&o.length===o.filter(":checked").length)})},getSelects:function(e){var s=this,i=[],l=[];return this.$drop.find("input["+this.selectItemName+"]:checked").each(function(){i.push(t(this).parents("li").first().text()),l.push(t(this).val())}),"text"===e&&this.$selectGroups.length&&(i=[],this.$selectGroups.each(function(){var h,e=[],l=t.trim(t(this).parent().text()),c=t(this).parent().data("group"),n=s.$drop.find("["+s.selectItemName+'][data-group="'+c+'"]'),c=n.filter(":checked");0!==c.length&&(e.push("["),e.push(l),n.length>c.length&&(h=[],c.each(function(){h.push(t(this).parent().text())}),e.push(": "+h.join(", "))),e.push("]"),i.push(e.join("")))})),"text"===e?i:l},setSelects:function(e){var s=this;this.$selectItems.prop("checked",!1),t.each(e,function(t,e){s.$selectItems.filter('[value="'+e+'"]').prop("checked",!0)}),this.$selectAll.prop("checked",this.$selectItems.length===this.$selectItems.filter(":checked").length),this.update()},enable:function(){this.$choice.removeClass("disabled")},disable:function(){this.$choice.addClass("disabled")},checkAll:function(){this.$selectItems.prop("checked",!0),this.$selectGroups.prop("checked",!0),this.$selectAll.prop("checked",!0),this.update(),this.options.onCheckAll()},uncheckAll:function(){this.$selectItems.prop("checked",!1),this.$selectGroups.prop("checked",!1),this.$selectAll.prop("checked",!1),this.update(),this.options.onUncheckAll()},focus:function(){this.$choice.focus(),this.options.onFocus()},blur:function(){this.$choice.blur(),this.options.onBlur()},refresh:function(){this.init()},filter:function(){var e=this,s=t.trim(this.$searchInput.val()).toLowerCase();0===s.length?(this.$selectItems.parent().show(),this.$disableItems.parent().show(),this.$selectGroups.parent().show()):(this.$selectItems.each(function(){var e=t(this).parent();e[e.text().toLowerCase().indexOf(s)<0?"hide":"show"]()}),this.$disableItems.parent().hide(),this.$selectGroups.each(function(){var s=t(this).parent(),i=s.attr("data-group");s[0===e.$selectItems.filter(":visible").filter('[data-group="'+i+'"]').length?"hide":"show"]()}),this.$selectItems.filter(":visible").length?(this.$selectAll.parent().show(),this.$noResults.hide()):(this.$selectAll.parent().hide(),this.$noResults.show())),this.updateOptGroupSelect(),this.updateSelectAll()}},t.fn.multipleSelect=function(){var s,i=arguments[0],l=arguments,o=["getSelects","setSelects","enable","disable","checkAll","uncheckAll","focus","blur","refresh"];return this.each(function(){var n=t(this),c=n.data("multipleSelect"),h=t.extend({},t.fn.multipleSelect.defaults,n.data(),"object"==typeof i&&i);if(c||(c=new e(n,h),n.data("multipleSelect",c)),"string"==typeof i){if(t.inArray(i,o)<0)throw"Unknown method: "+i;s=c[i](l[1])}else c.init(),l[1]&&(s=c[l[1]].apply(c,[].slice.call(l,2)))}),s||this},t.fn.multipleSelect.defaults={name:"",isOpen:!1,placeholder:"",selectAll:!0,selectAllText:"Select all",selectAllDelimiter:["[","]"],allSelected:"All selected",minumimCountSelected:3,countSelected:"# of % selected",noMatchesFound:"No matches found",multiple:!1,multipleWidth:80,single:!1,filter:!1,width:void 0,maxHeight:250,container:null,position:"bottom",keepOpen:!1,blockSeparator:"",displayValues:!1,delimiter:", ",styler:function(){return!1},textTemplate:function(t){return t.text()},onOpen:function(){return!1},onClose:function(){return!1},onCheckAll:function(){return!1},onUncheckAll:function(){return!1},onFocus:function(){return!1},onBlur:function(){return!1},onOptgroupClick:function(){return!1},onClick:function(){return!1}}}(jQuery);