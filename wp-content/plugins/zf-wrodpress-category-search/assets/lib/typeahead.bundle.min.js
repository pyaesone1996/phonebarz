!function($){var _=function(){"use strict";return{isMsie:function(){return!!/(msie|trident)/i.test(navigator.userAgent)&&navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]},isBlankString:function(str){return!str||/^\s*$/.test(str)},escapeRegExChars:function(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(obj){return"string"==typeof obj},isNumber:function(obj){return"number"==typeof obj},isArray:$.isArray,isFunction:$.isFunction,isObject:$.isPlainObject,isUndefined:function(obj){return void 0===obj},toStr:function(s){return _.isUndefined(s)||null===s?"":s+""},bind:$.proxy,each:function(collection,cb){$.each(collection,function(index,value){return cb(value,index)})},map:$.map,filter:$.grep,every:function(obj,test){var result=!0;return obj?($.each(obj,function(key,val){if(!(result=test.call(null,val,key,obj)))return!1}),!!result):result},some:function(obj,test){var result=!1;return obj?($.each(obj,function(key,val){if(result=test.call(null,val,key,obj))return!1}),!!result):result},mixin:$.extend,getUniqueId:(counter=0,function(){return counter++}),templatify:function(obj){return $.isFunction(obj)?obj:function(){return String(obj)}},defer:function(fn){setTimeout(fn,0)},debounce:function(func,wait,immediate){var timeout,result;return function(){var context=this,args=arguments,later=function(){timeout=null,immediate||(result=func.apply(context,args))},callNow=immediate&&!timeout;return clearTimeout(timeout),timeout=setTimeout(later,wait),result=callNow?func.apply(context,args):result}},throttle:function(func,wait){var context,args,timeout,result,previous=0,later=function(){previous=new Date,timeout=null,result=func.apply(context,args)};return function(){var now=new Date,remaining=wait-(now-previous);return context=this,args=arguments,remaining<=0?(clearTimeout(timeout),timeout=null,previous=now,result=func.apply(context,args)):timeout=timeout||setTimeout(later,remaining),result}},noop:function(){}};var counter}(),tokenizers=function(){"use strict";return{nonword:nonword,whitespace:whitespace,obj:{nonword:getObjTokenizer(nonword),whitespace:getObjTokenizer(whitespace)}};function whitespace(str){return(str=_.toStr(str))?str.split(/\s+/):[]}function nonword(str){return(str=_.toStr(str))?str.split(/\W+/):[]}function getObjTokenizer(tokenizer){return function(){var args=[].slice.call(arguments,0);return function(o){var tokens=[];return _.each(args,function(k){tokens=tokens.concat(tokenizer(_.toStr(o[k])))}),tokens}}}}(),LruCache=function(){"use strict";function LruCache(maxSize){this.maxSize=_.isNumber(maxSize)?maxSize:100,this.reset(),this.maxSize<=0&&(this.set=this.get=$.noop)}function List(){this.head=this.tail=null}function Node(key,val){this.key=key,this.val=val,this.prev=this.next=null}return _.mixin(LruCache.prototype,{set:function(key,val){var node=this.list.tail;this.size>=this.maxSize&&(this.list.remove(node),delete this.hash[node.key]),(node=this.hash[key])?(node.val=val,this.list.moveToFront(node)):(node=new Node(key,val),this.list.add(node),this.hash[key]=node,this.size++)},get:function(node){node=this.hash[node];if(node)return this.list.moveToFront(node),node.val},reset:function(){this.size=0,this.hash={},this.list=new List}}),_.mixin(List.prototype,{add:function(node){this.head&&(node.next=this.head,this.head.prev=node),this.head=node,this.tail=this.tail||node},remove:function(node){node.prev?node.prev.next=node.next:this.head=node.next,node.next?node.next.prev=node.prev:this.tail=node.prev},moveToFront:function(node){this.remove(node),this.add(node)}}),LruCache}(),PersistentStorage=function(){"use strict";var ls,methods;try{(ls=window.localStorage).setItem("~~~","!"),ls.removeItem("~~~")}catch(err){ls=null}function PersistentStorage(namespace){this.prefix=["__",namespace,"__"].join(""),this.ttlKey="__ttl__",this.keyMatcher=new RegExp("^"+_.escapeRegExChars(this.prefix))}return methods=ls&&window.JSON?{_prefix:function(key){return this.prefix+key},_ttlKey:function(key){return this._prefix(key)+this.ttlKey},get:function(key){return this.isExpired(key)&&this.remove(key),decode(ls.getItem(this._prefix(key)))},set:function(key,val,ttl){return _.isNumber(ttl)?ls.setItem(this._ttlKey(key),encode(now()+ttl)):ls.removeItem(this._ttlKey(key)),ls.setItem(this._prefix(key),encode(val))},remove:function(key){return ls.removeItem(this._ttlKey(key)),ls.removeItem(this._prefix(key)),this},clear:function(){for(var key,keys=[],len=ls.length,i=0;i<len;i++)(key=ls.key(i)).match(this.keyMatcher)&&keys.push(key.replace(this.keyMatcher,""));for(i=keys.length;i--;)this.remove(keys[i]);return this},isExpired:function(ttl){ttl=decode(ls.getItem(this._ttlKey(ttl)));return!!(_.isNumber(ttl)&&now()>ttl)}}:{get:_.noop,set:_.noop,remove:_.noop,clear:_.noop,isExpired:_.noop},_.mixin(PersistentStorage.prototype,methods),PersistentStorage;function now(){return(new Date).getTime()}function encode(val){return JSON.stringify(_.isUndefined(val)?null:val)}function decode(val){return JSON.parse(val)}}(),Transport=function(){"use strict";var pendingRequestsCount=0,pendingRequests={},maxPendingRequests=6,sharedCache=new LruCache(10);function Transport(o){var fn;o=o||{},this.cancelled=!1,this.lastUrl=null,this._send=o.transport?(fn=o.transport,function(url,o){var deferred=$.Deferred();return fn(url,o,function(resp){_.defer(function(){deferred.resolve(resp)})},function(err){_.defer(function(){deferred.reject(err)})}),deferred}):$.ajax,this._get=o.rateLimiter?o.rateLimiter(this._get):this._get,this._cache=!1===o.cache?new LruCache(0):sharedCache}return Transport.setMaxPendingRequests=function(num){maxPendingRequests=num},Transport.resetCache=function(){sharedCache.reset()},_.mixin(Transport.prototype,{_get:function(url,o,cb){var jqXhr,that=this;function done(resp){cb&&cb(null,resp),that._cache.set(url,resp)}function fail(){cb&&cb(!0)}this.cancelled||url!==this.lastUrl||((jqXhr=pendingRequests[url])?jqXhr.done(done).fail(fail):pendingRequestsCount<maxPendingRequests?(pendingRequestsCount++,pendingRequests[url]=this._send(url,o).done(done).fail(fail).always(function(){pendingRequestsCount--,delete pendingRequests[url],that.onDeckRequestArgs&&(that._get.apply(that,that.onDeckRequestArgs),that.onDeckRequestArgs=null)})):this.onDeckRequestArgs=[].slice.call(arguments,0))},get:function(url,o,cb){var resp;return _.isFunction(o)&&(cb=o,o={}),this.cancelled=!1,this.lastUrl=url,(resp=this._cache.get(url))?_.defer(function(){cb&&cb(null,resp)}):this._get(url,o,cb),!!resp},cancel:function(){this.cancelled=!0}}),Transport}(),SearchIndex=function(){"use strict";function SearchIndex(o){(o=o||{}).datumTokenizer&&o.queryTokenizer||$.error("datumTokenizer and queryTokenizer are both required"),this.datumTokenizer=o.datumTokenizer,this.queryTokenizer=o.queryTokenizer,this.reset()}return _.mixin(SearchIndex.prototype,{bootstrap:function(o){this.datums=o.datums,this.trie=o.trie},add:function(data){var that=this;data=_.isArray(data)?data:[data],_.each(data,function(tokens){var id=that.datums.push(tokens)-1,tokens=normalizeTokens(that.datumTokenizer(tokens));_.each(tokens,function(token){for(var ch,node=that.trie,chars=token.split("");ch=chars.shift();)(node=node.children[ch]||(node.children[ch]=newNode())).ids.push(id)})})},get:function(tokens){var matches,that=this,tokens=normalizeTokens(this.queryTokenizer(tokens));return _.each(tokens,function(ids){var node,chars,ch;if(matches&&0===matches.length)return!1;for(node=that.trie,chars=ids.split("");node&&(ch=chars.shift());)node=node.children[ch];if(!node||0!==chars.length)return!(matches=[]);ids=node.ids.slice(0),matches=matches?function(arrayA,arrayB){var ai=0,bi=0,intersection=[];arrayA=arrayA.sort(compare),arrayB=arrayB.sort(compare);var lenArrayA=arrayA.length,lenArrayB=arrayB.length;for(;ai<lenArrayA&&bi<lenArrayB;)arrayA[ai]<arrayB[bi]?ai++:(arrayA[ai]>arrayB[bi]||(intersection.push(arrayA[ai]),ai++),bi++);return intersection;function compare(a,b){return a-b}}(matches,ids):ids}),matches?_.map(function(array){for(var seen={},uniques=[],i=0,len=array.length;i<len;i++)seen[array[i]]||(seen[array[i]]=!0,uniques.push(array[i]));return uniques}(matches),function(id){return that.datums[id]}):[]},reset:function(){this.datums=[],this.trie=newNode()},serialize:function(){return{datums:this.datums,trie:this.trie}}}),SearchIndex;function normalizeTokens(tokens){return tokens=_.filter(tokens,function(token){return!!token}),tokens=_.map(tokens,function(token){return token.toLowerCase()})}function newNode(){return{ids:[],children:{}}}}(),oParser=function(){"use strict";return{local:function(o){return o.local||null},prefetch:function(prefetch){var defaults;defaults={url:null,thumbprint:"",ttl:864e5,filter:null,ajax:{}},(prefetch=prefetch.prefetch||null)&&(prefetch=_.isString(prefetch)?{url:prefetch}:prefetch,(prefetch=_.mixin(defaults,prefetch)).thumbprint="0.10.5"+prefetch.thumbprint,prefetch.ajax.type=prefetch.ajax.type||"GET",prefetch.ajax.dataType=prefetch.ajax.dataType||"json",prefetch.url||$.error("prefetch requires url to be set"));return prefetch},remote:function(remote){var defaults;defaults={url:null,cache:!0,wildcard:"%QUERY",replace:null,rateLimitBy:"debounce",rateLimitWait:300,send:null,filter:null,ajax:{}},(remote=remote.remote||null)&&(remote=_.isString(remote)?{url:remote}:remote,(remote=_.mixin(defaults,remote)).rateLimiter=(/^throttle$/i.test(remote.rateLimitBy)?function(wait){return function(fn){return _.throttle(fn,wait)}}:function(wait){return function(fn){return _.debounce(fn,wait)}})(remote.rateLimitWait),remote.ajax.type=remote.ajax.type||"GET",remote.ajax.dataType=remote.ajax.dataType||"json",delete remote.rateLimitBy,delete remote.rateLimitWait,remote.url||$.error("remote requires url to be set"));return remote}}}();!function(root){"use strict";var old,keys;function Bloodhound(o){var sortFn;o&&(o.local||o.prefetch||o.remote)||$.error("one of local, prefetch, or remote is required"),this.limit=o.limit||5,this.sorter=(sortFn=o.sorter,_.isFunction(sortFn)?function(array){return array.sort(sortFn)}:function(array){return array}),this.dupDetector=o.dupDetector||ignoreDuplicates,this.local=oParser.local(o),this.prefetch=oParser.prefetch(o),this.remote=oParser.remote(o),this.cacheKey=this.prefetch?this.prefetch.cacheKey||this.prefetch.url:null,this.index=new SearchIndex({datumTokenizer:o.datumTokenizer,queryTokenizer:o.queryTokenizer}),this.storage=this.cacheKey?new PersistentStorage(this.cacheKey):null}return old=root.Bloodhound,keys={data:"data",protocol:"protocol",thumbprint:"thumbprint"},(root.Bloodhound=Bloodhound).noConflict=function(){return root.Bloodhound=old,Bloodhound},Bloodhound.tokenizers=tokenizers,_.mixin(Bloodhound.prototype,{_loadPrefetch:function(o){var that=this,deferred=(deferred=this._readFromStorage(o.thumbprint))?(this.index.bootstrap(deferred),$.Deferred().resolve()):$.ajax(o.url,o.ajax).done(function(resp){that.clear(),that.add(o.filter?o.filter(resp):resp),that._saveToStorage(that.index.serialize(),o.thumbprint,o.ttl)});return deferred},_getFromRemote:function(query,cb){var url,that=this;if(this.transport)return query=query||"",url=encodeURIComponent(query),url=this.remote.replace?this.remote.replace(this.remote.url,query):this.remote.url.replace(this.remote.wildcard,url),this.transport.get(url,this.remote.ajax,function(err,resp){cb(err?[]:that.remote.filter?that.remote.filter(resp):resp)})},_cancelLastRemoteRequest:function(){this.transport&&this.transport.cancel()},_saveToStorage:function(data,thumbprint,ttl){this.storage&&(this.storage.set(keys.data,data,ttl),this.storage.set(keys.protocol,location.protocol,ttl),this.storage.set(keys.thumbprint,thumbprint,ttl))},_readFromStorage:function(isExpired){var stored={};return this.storage&&(stored.data=this.storage.get(keys.data),stored.protocol=this.storage.get(keys.protocol),stored.thumbprint=this.storage.get(keys.thumbprint)),isExpired=stored.thumbprint!==isExpired||stored.protocol!==location.protocol,stored.data&&!isExpired?stored.data:null},_initialize:function(){var that=this,local=this.local,deferred=this.prefetch?this._loadPrefetch(this.prefetch):$.Deferred().resolve();return local&&deferred.done(function(){that.add(_.isFunction(local)?local():local)}),this.transport=this.remote?new Transport(this.remote):null,this.initPromise=deferred.promise()},initialize:function(force){return!this.initPromise||force?this._initialize():this.initPromise},add:function(data){this.index.add(data)},get:function(query,cb){var that=this,matches=[],cacheHit=!1;matches=this.index.get(query),(matches=this.sorter(matches).slice(0,this.limit)).length<this.limit?cacheHit=this._getFromRemote(query,function(remoteMatches){var matchesWithBackfill=matches.slice(0);_.each(remoteMatches,function(remoteMatch){return _.some(matchesWithBackfill,function(match){return that.dupDetector(remoteMatch,match)})||matchesWithBackfill.push(remoteMatch),matchesWithBackfill.length<that.limit}),cb&&cb(that.sorter(matchesWithBackfill))}):this._cancelLastRemoteRequest(),cacheHit||(0<matches.length||!this.transport)&&cb&&cb(matches)},clear:function(){this.index.reset()},clearPrefetchCache:function(){this.storage&&this.storage.clear()},clearRemoteCache:function(){this.transport&&Transport.resetCache()},ttAdapter:function(){return _.bind(this.get,this)}});function ignoreDuplicates(){return!1}}(this);var html={wrapper:'<span class="twitter-typeahead"></span>',dropdown:'<span class="tt-dropdown-menu"></span>',dataset:'<div class="tt-dataset-%CLASS%"></div>',suggestions:'<span class="tt-suggestions"></span>',suggestion:'<div class="tt-suggestion"></div>'},css=function(){"use strict";var css={wrapper:{position:"relative",display:"inline-block"},hint:{position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none",opacity:"1"},input:{position:"relative",verticalAlign:"top",backgroundColor:"transparent"},inputWithNoHint:{position:"relative",verticalAlign:"top"},dropdown:{position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"},suggestions:{display:"block"},suggestion:{whiteSpace:"nowrap",cursor:"pointer"},suggestionChild:{whiteSpace:"normal"},ltr:{left:"0",right:"auto"},rtl:{left:"auto",right:" 0"}};return _.isMsie()&&_.mixin(css.input,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"}),_.isMsie()&&_.isMsie()<=7&&_.mixin(css.input,{marginTop:"-1px"}),css}(),EventBus=function(){"use strict";function EventBus(o){o&&o.el||$.error("EventBus initialized without el"),this.$el=$(o.el)}return _.mixin(EventBus.prototype,{trigger:function(type){var args=[].slice.call(arguments,1);this.$el.trigger("typeahead:"+type,args)}}),EventBus}(),EventEmitter=function(){"use strict";var splitter=/\s+/,nextTick=function(){var nextTickFn;nextTickFn=window.setImmediate?function(fn){setImmediate(function(){fn()})}:function(fn){setTimeout(function(){fn()},0)};return nextTickFn}();return{onSync:function(types,cb,context){return on.call(this,"sync",types,cb,context)},onAsync:function(types,cb,context){return on.call(this,"async",types,cb,context)},off:function(types){var type;if(!this._callbacks)return this;types=types.split(splitter);for(;type=types.shift();)delete this._callbacks[type];return this},trigger:function(types){var callbacks,args,syncFlush,asyncFlush;if(!this._callbacks)return this;types=types.split(splitter),args=[].slice.call(arguments,1);for(;(asyncFlush=types.shift())&&(callbacks=this._callbacks[asyncFlush]);)syncFlush=getFlush(callbacks.sync,this,[asyncFlush].concat(args)),asyncFlush=getFlush(callbacks.async,this,[asyncFlush].concat(args)),syncFlush()&&nextTick(asyncFlush);return this}};function on(method,types,cb,context){var type;if(!cb)return this;for(types=types.split(splitter),cb=context?function(fn,context){return fn.bind?fn.bind(context):function(){fn.apply(context,[].slice.call(arguments,0))}}(cb,context):cb,this._callbacks=this._callbacks||{};type=types.shift();)this._callbacks[type]=this._callbacks[type]||{sync:[],async:[]},this._callbacks[type][method].push(cb);return this}function getFlush(callbacks,context,args){return function(){for(var cancelled,i=0,len=callbacks.length;!cancelled&&i<len;i+=1)cancelled=!1===callbacks[i].apply(context,args);return!cancelled}}}(),highlight=function(doc){"use strict";var defaults={node:null,pattern:null,tagName:"strong",className:null,wordsOnly:!1,caseSensitive:!1};return function(o){var regex;(o=_.mixin({},defaults,o)).node&&o.pattern&&(o.pattern=_.isArray(o.pattern)?o.pattern:[o.pattern],regex=function(patterns,caseSensitive,regexStr){for(var escapedPatterns=[],i=0,len=patterns.length;i<len;i++)escapedPatterns.push(_.escapeRegExChars(patterns[i]));return regexStr=regexStr?"\\b("+escapedPatterns.join("|")+")\\b":"("+escapedPatterns.join("|")+")",caseSensitive?new RegExp(regexStr):new RegExp(regexStr,"i")}(o.pattern,o.caseSensitive,o.wordsOnly),function traverse(el,hightlightTextNode){var childNode;for(var i=0;i<el.childNodes.length;i++)3===(childNode=el.childNodes[i]).nodeType?i+=hightlightTextNode(childNode)?1:0:traverse(childNode,hightlightTextNode)}(o.node,function(textNode){var match,patternNode,wrapperNode;(match=regex.exec(textNode.data))&&(wrapperNode=doc.createElement(o.tagName),o.className&&(wrapperNode.className=o.className),(patternNode=textNode.splitText(match.index)).splitText(match[0].length),wrapperNode.appendChild(patternNode.cloneNode(!0)),textNode.parentNode.replaceChild(wrapperNode,patternNode));return!!match}))}}(window.document),Input=function(){"use strict";var specialKeyCodeMap;function Input(o){var onBlur,onFocus,onKeydown,$input,that=this;(o=o||{}).input||$.error("input is missing"),onBlur=_.bind(this._onBlur,this),onFocus=_.bind(this._onFocus,this),onKeydown=_.bind(this._onKeydown,this),$input=_.bind(this._onInput,this),this.$hint=$(o.hint),this.$input=$(o.input).on("blur.tt",onBlur).on("focus.tt",onFocus).on("keydown.tt",onKeydown),0===this.$hint.length&&(this.setHint=this.getHint=this.clearHint=this.clearHintIfInvalid=_.noop),_.isMsie()?this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",function($e){specialKeyCodeMap[$e.which||$e.keyCode]||_.defer(_.bind(that._onInput,that,$e))}):this.$input.on("input.tt",$input),this.query=this.$input.val(),this.$overflowHelper=($input=this.$input,$('<pre aria-hidden="true"></pre>').css({position:"absolute",visibility:"hidden",whiteSpace:"pre",fontFamily:$input.css("font-family"),fontSize:$input.css("font-size"),fontStyle:$input.css("font-style"),fontVariant:$input.css("font-variant"),fontWeight:$input.css("font-weight"),wordSpacing:$input.css("word-spacing"),letterSpacing:$input.css("letter-spacing"),textIndent:$input.css("text-indent"),textRendering:$input.css("text-rendering"),textTransform:$input.css("text-transform")}).insertAfter($input))}return specialKeyCodeMap={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"},Input.normalizeQuery=function(str){return(str||"").replace(/^\s*/g,"").replace(/\s{2,}/g," ")},_.mixin(Input.prototype,EventEmitter,{_onBlur:function(){this.resetInputValue(),this.trigger("blurred")},_onFocus:function(){this.trigger("focused")},_onKeydown:function($e){var keyName=specialKeyCodeMap[$e.which||$e.keyCode];this._managePreventDefault(keyName,$e),keyName&&this._shouldTrigger(keyName,$e)&&this.trigger(keyName+"Keyed",$e)},_onInput:function(){this._checkInputValue()},_managePreventDefault:function(keyName,$e){var preventDefault,hintValue,inputValue;switch(keyName){case"tab":hintValue=this.getHint(),inputValue=this.getInputValue(),preventDefault=hintValue&&hintValue!==inputValue&&!withModifier($e);break;case"up":case"down":preventDefault=!withModifier($e);break;default:preventDefault=!1}preventDefault&&$e.preventDefault()},_shouldTrigger:function(keyName,trigger){trigger="tab"!==keyName||!withModifier(trigger);return trigger},_checkInputValue:function(){var areEquivalent,hasDifferentWhitespace,inputValue=this.getInputValue();areEquivalent=inputValue,hasDifferentWhitespace=this.query,hasDifferentWhitespace=(areEquivalent=Input.normalizeQuery(areEquivalent)===Input.normalizeQuery(hasDifferentWhitespace))&&this.query.length!==inputValue.length,this.query=inputValue,areEquivalent?hasDifferentWhitespace&&this.trigger("whitespaceChanged",this.query):this.trigger("queryChanged",this.query)},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},getQuery:function(){return this.query},setQuery:function(query){this.query=query},getInputValue:function(){return this.$input.val()},setInputValue:function(value,silent){this.$input.val(value),silent?this.clearHint():this._checkInputValue()},resetInputValue:function(){this.setInputValue(this.query,!0)},getHint:function(){return this.$hint.val()},setHint:function(value){this.$hint.val(value)},clearHint:function(){this.setHint("")},clearHintIfInvalid:function(){var val=this.getInputValue(),valIsPrefixOfHint=this.getHint(),valIsPrefixOfHint=val!==valIsPrefixOfHint&&0===valIsPrefixOfHint.indexOf(val);""!==val&&valIsPrefixOfHint&&!this.hasOverflow()||this.clearHint()},getLanguageDirection:function(){return(this.$input.css("direction")||"ltr").toLowerCase()},hasOverflow:function(){var constraint=this.$input.width()-2;return this.$overflowHelper.text(this.getInputValue()),this.$overflowHelper.width()>=constraint},isCursorAtEnd:function(){var valueLength=this.$input.val().length,range=this.$input[0].selectionStart;return _.isNumber(range)?range===valueLength:!document.selection||((range=document.selection.createRange()).moveStart("character",-valueLength),valueLength===range.text.length)},destroy:function(){this.$hint.off(".tt"),this.$input.off(".tt"),this.$hint=this.$input=this.$overflowHelper=null}}),Input;function withModifier($e){return $e.altKey||$e.ctrlKey||$e.metaKey||$e.shiftKey}}(),Dataset=function(){"use strict";function Dataset(o){var display;(o=o||{}).templates=o.templates||{},o.source||$.error("missing source"),o.name&&!/^[_a-zA-Z0-9-]+$/.test(o.name)&&$.error("invalid dataset name: "+o.name),this.query=null,this.highlight=!!o.highlight,this.name=o.name||_.getUniqueId(),this.source=o.source,this.displayFn=(display=(display=o.display||o.displayKey)||"value",_.isFunction(display)?display:function(obj){return obj[display]}),this.templates=function(templates,displayFn){return{empty:templates.empty&&_.templatify(templates.empty),header:templates.header&&_.templatify(templates.header),footer:templates.footer&&_.templatify(templates.footer),suggestion:templates.suggestion||function(context){return"<p>"+displayFn(context)+"</p>"}}}(o.templates,this.displayFn),this.$el=$(html.dataset.replace("%CLASS%",this.name))}return Dataset.extractDatasetName=function(el){return $(el).data("ttDataset")},Dataset.extractValue=function(el){return $(el).data("ttValue")},Dataset.extractDatum=function(el){return $(el).data("ttDatum")},_.mixin(Dataset.prototype,EventEmitter,{_render:function(query,suggestions){var that,hasSuggestions,$suggestions,nodes;function getHeaderHtml(){return that.templates.header({query:query,isEmpty:!hasSuggestions})}function getFooterHtml(){return that.templates.footer({query:query,isEmpty:!hasSuggestions})}this.$el&&((that=this).$el.empty(),!(hasSuggestions=suggestions&&suggestions.length)&&this.templates.empty?this.$el.html(that.templates.empty({query:query,isEmpty:!0})).prepend(that.templates.header?getHeaderHtml():null).append(that.templates.footer?getFooterHtml():null):hasSuggestions&&this.$el.html(($suggestions=$(html.suggestions).css(css.suggestions),nodes=_.map(suggestions,function($el){return($el=$(html.suggestion).append(that.templates.suggestion($el)).data("ttDataset",that.name).data("ttValue",that.displayFn($el)).data("ttDatum",$el)).children().each(function(){$(this).css(css.suggestionChild)}),$el}),$suggestions.append.apply($suggestions,nodes),that.highlight&&highlight({className:"tt-highlight",node:$suggestions[0],pattern:query}),$suggestions)).prepend(that.templates.header?getHeaderHtml():null).append(that.templates.footer?getFooterHtml():null),this.trigger("rendered"))},getRoot:function(){return this.$el},update:function(query){var that=this;this.query=query,this.canceled=!1,this.source(query,function(suggestions){that.canceled||query!==that.query||that._render(query,suggestions)})},cancel:function(){this.canceled=!0},clear:function(){this.cancel(),this.$el.empty(),this.trigger("rendered")},isEmpty:function(){return this.$el.is(":empty")},destroy:function(){this.$el=null}}),Dataset}(),Dropdown=function(){"use strict";function Dropdown(o){var onSuggestionClick,onSuggestionMouseEnter,onSuggestionMouseLeave,that=this;(o=o||{}).menu||$.error("menu is required"),this.isOpen=!1,this.isEmpty=!0,this.datasets=_.map(o.datasets,initializeDataset),onSuggestionClick=_.bind(this._onSuggestionClick,this),onSuggestionMouseEnter=_.bind(this._onSuggestionMouseEnter,this),onSuggestionMouseLeave=_.bind(this._onSuggestionMouseLeave,this),this.$menu=$(o.menu).on("click.tt",".tt-suggestion",onSuggestionClick).on("mouseenter.tt",".tt-suggestion",onSuggestionMouseEnter).on("mouseleave.tt",".tt-suggestion",onSuggestionMouseLeave),_.each(this.datasets,function(dataset){that.$menu.append(dataset.getRoot()),dataset.onSync("rendered",that._onRendered,that)})}return _.mixin(Dropdown.prototype,EventEmitter,{_onSuggestionClick:function($e){this.trigger("suggestionClicked",$($e.currentTarget))},_onSuggestionMouseEnter:function($e){this._removeCursor(),this._setCursor($($e.currentTarget),!0)},_onSuggestionMouseLeave:function(){this._removeCursor()},_onRendered:function(){this.isEmpty=_.every(this.datasets,function(dataset){return dataset.isEmpty()}),this.isEmpty?this._hide():this.isOpen&&this._show(),this.trigger("datasetRendered")},_hide:function(){this.$menu.hide()},_show:function(){this.$menu.css("display","block")},_getSuggestions:function(){return this.$menu.find(".tt-suggestion")},_getCursor:function(){return this.$menu.find(".tt-cursor").first()},_setCursor:function($el,silent){$el.first().addClass("tt-cursor"),silent||this.trigger("cursorMoved")},_removeCursor:function(){this._getCursor().removeClass("tt-cursor")},_moveCursor:function($newCursor){var $suggestions,$oldCursor;this.isOpen&&($oldCursor=this._getCursor(),$suggestions=this._getSuggestions(),this._removeCursor(),-1!==($newCursor=(($newCursor=$suggestions.index($oldCursor)+$newCursor)+1)%($suggestions.length+1)-1)?($newCursor<-1&&($newCursor=$suggestions.length-1),this._setCursor($newCursor=$suggestions.eq($newCursor)),this._ensureVisible($newCursor)):this.trigger("cursorRemoved"))},_ensureVisible:function(menuHeight){var elTop=menuHeight.position().top,elBottom=elTop+menuHeight.outerHeight(!0),menuScrollTop=this.$menu.scrollTop(),menuHeight=this.$menu.height()+parseInt(this.$menu.css("paddingTop"),10)+parseInt(this.$menu.css("paddingBottom"),10);elTop<0?this.$menu.scrollTop(menuScrollTop+elTop):menuHeight<elBottom&&this.$menu.scrollTop(menuScrollTop+(elBottom-menuHeight))},close:function(){this.isOpen&&(this.isOpen=!1,this._removeCursor(),this._hide(),this.trigger("closed"))},open:function(){this.isOpen||(this.isOpen=!0,this.isEmpty||this._show(),this.trigger("opened"))},setLanguageDirection:function(dir){this.$menu.css("ltr"===dir?css.ltr:css.rtl)},moveCursorUp:function(){this._moveCursor(-1)},moveCursorDown:function(){this._moveCursor(1)},getDatumForSuggestion:function($el){var datum=null;return datum=$el.length?{raw:Dataset.extractDatum($el),value:Dataset.extractValue($el),datasetName:Dataset.extractDatasetName($el)}:datum},getDatumForCursor:function(){return this.getDatumForSuggestion(this._getCursor().first())},getDatumForTopSuggestion:function(){return this.getDatumForSuggestion(this._getSuggestions().first())},update:function(query){_.each(this.datasets,function(dataset){dataset.update(query)})},empty:function(){_.each(this.datasets,function(dataset){dataset.clear()}),this.isEmpty=!0},isVisible:function(){return this.isOpen&&!this.isEmpty},destroy:function(){this.$menu.off(".tt"),this.$menu=null,_.each(this.datasets,function(dataset){dataset.destroy()})}}),Dropdown;function initializeDataset(oDataset){return new Dataset(oDataset)}}(),Typeahead=function(){"use strict";var attrsKey="ttAttrs";function Typeahead(o){var $menu,$input,$hint;(o=o||{}).input||$.error("missing input"),this.isActivated=!1,this.autoselect=!!o.autoselect,this.minLength=_.isNumber(o.minLength)?o.minLength:1,this.$node=function($hint,withHint){var $input,$wrapper,$dropdown;$input=$($hint),$wrapper=$(html.wrapper).css(css.wrapper),$dropdown=$(html.dropdown).css(css.dropdown),($hint=$input.clone().css(css.hint).css(function($el){return{backgroundAttachment:$el.css("background-attachment"),backgroundClip:$el.css("background-clip"),backgroundColor:$el.css("background-color"),backgroundImage:$el.css("background-image"),backgroundOrigin:$el.css("background-origin"),backgroundPosition:$el.css("background-position"),backgroundRepeat:$el.css("background-repeat"),backgroundSize:$el.css("background-size")}}($input))).val("").removeData().addClass("tt-hint").removeAttr("id name placeholder required").prop("readonly",!0).attr({autocomplete:"off",spellcheck:"false",tabindex:-1}),$input.data(attrsKey,{dir:$input.attr("dir"),autocomplete:$input.attr("autocomplete"),spellcheck:$input.attr("spellcheck"),style:$input.attr("style")}),$input.addClass("tt-input").attr({autocomplete:"off",spellcheck:!1}).css(withHint?css.input:css.inputWithNoHint);try{$input.attr("dir")||$input.attr("dir","auto")}catch(e){}return $input.wrap($wrapper).parent().prepend(withHint?$hint:null).append($dropdown)}(o.input,o.withHint),$menu=this.$node.find(".tt-dropdown-menu"),$input=this.$node.find(".tt-input"),$hint=this.$node.find(".tt-hint"),$input.on("blur.tt",function($e){var hasActive=document.activeElement,isActive=$menu.is(hasActive),hasActive=0<$menu.has(hasActive).length;_.isMsie()&&(isActive||hasActive)&&($e.preventDefault(),$e.stopImmediatePropagation(),_.defer(function(){$input.focus()}))}),$menu.on("mousedown.tt",function($e){$e.preventDefault()}),this.eventBus=o.eventBus||new EventBus({el:$input}),this.dropdown=new Dropdown({menu:$menu,datasets:o.datasets}).onSync("suggestionClicked",this._onSuggestionClicked,this).onSync("cursorMoved",this._onCursorMoved,this).onSync("cursorRemoved",this._onCursorRemoved,this).onSync("opened",this._onOpened,this).onSync("closed",this._onClosed,this).onAsync("datasetRendered",this._onDatasetRendered,this),this.input=new Input({input:$input,hint:$hint}).onSync("focused",this._onFocused,this).onSync("blurred",this._onBlurred,this).onSync("enterKeyed",this._onEnterKeyed,this).onSync("tabKeyed",this._onTabKeyed,this).onSync("escKeyed",this._onEscKeyed,this).onSync("upKeyed",this._onUpKeyed,this).onSync("downKeyed",this._onDownKeyed,this).onSync("leftKeyed",this._onLeftKeyed,this).onSync("rightKeyed",this._onRightKeyed,this).onSync("queryChanged",this._onQueryChanged,this).onSync("whitespaceChanged",this._onWhitespaceChanged,this),this._setLanguageDirection()}return _.mixin(Typeahead.prototype,{_onSuggestionClicked:function(type,datum){(datum=this.dropdown.getDatumForSuggestion(datum))&&this._select(datum)},_onCursorMoved:function(){var datum=this.dropdown.getDatumForCursor();this.input.setInputValue(datum.value,!0),this.eventBus.trigger("cursorchanged",datum.raw,datum.datasetName)},_onCursorRemoved:function(){this.input.resetInputValue(),this._updateHint()},_onDatasetRendered:function(){this._updateHint()},_onOpened:function(){this._updateHint(),this.eventBus.trigger("opened")},_onClosed:function(){this.input.clearHint(),this.eventBus.trigger("closed")},_onFocused:function(){this.isActivated=!0,this.dropdown.open()},_onBlurred:function(){this.isActivated=!1,this.dropdown.empty(),this.dropdown.close()},_onEnterKeyed:function(type,$e){var cursorDatum=this.dropdown.getDatumForCursor(),topSuggestionDatum=this.dropdown.getDatumForTopSuggestion();cursorDatum?(this._select(cursorDatum),$e.preventDefault()):this.autoselect&&topSuggestionDatum&&(this._select(topSuggestionDatum),$e.preventDefault())},_onTabKeyed:function(type,$e){var datum;(datum=this.dropdown.getDatumForCursor())?(this._select(datum),$e.preventDefault()):this._autocomplete(!0)},_onEscKeyed:function(){this.dropdown.close(),this.input.resetInputValue()},_onUpKeyed:function(){var query=this.input.getQuery();this.dropdown.isEmpty&&query.length>=this.minLength?this.dropdown.update(query):this.dropdown.moveCursorUp(),this.dropdown.open()},_onDownKeyed:function(){var query=this.input.getQuery();this.dropdown.isEmpty&&query.length>=this.minLength?this.dropdown.update(query):this.dropdown.moveCursorDown(),this.dropdown.open()},_onLeftKeyed:function(){"rtl"===this.dir&&this._autocomplete()},_onRightKeyed:function(){"ltr"===this.dir&&this._autocomplete()},_onQueryChanged:function(e,query){this.input.clearHintIfInvalid(),query.length>=this.minLength?this.dropdown.update(query):this.dropdown.empty(),this.dropdown.open(),this._setLanguageDirection()},_onWhitespaceChanged:function(){this._updateHint(),this.dropdown.open()},_setLanguageDirection:function(){var dir;this.dir!==(dir=this.input.getLanguageDirection())&&(this.dir=dir,this.$node.css("direction",dir),this.dropdown.setLanguageDirection(dir))},_updateHint:function(){var val,escapedQuery,match=this.dropdown.getDatumForTopSuggestion();match&&this.dropdown.isVisible()&&!this.input.hasOverflow()?(val=this.input.getInputValue(),escapedQuery=Input.normalizeQuery(val),escapedQuery=_.escapeRegExChars(escapedQuery),(match=new RegExp("^(?:"+escapedQuery+")(.+$)","i").exec(match.value))?this.input.setHint(val+match[1]):this.input.clearHint()):this.input.clearHint()},_autocomplete:function(datum){var hint=this.input.getHint(),query=this.input.getQuery(),datum=datum||this.input.isCursorAtEnd();hint&&query!==hint&&datum&&((datum=this.dropdown.getDatumForTopSuggestion())&&this.input.setInputValue(datum.value),this.eventBus.trigger("autocompleted",datum.raw,datum.datasetName))},_select:function(datum){this.input.setQuery(datum.value),this.input.setInputValue(datum.value,!0),this._setLanguageDirection(),this.eventBus.trigger("selected",datum.raw,datum.datasetName),this.dropdown.close(),_.defer(_.bind(this.dropdown.empty,this.dropdown))},open:function(){this.dropdown.open()},close:function(){this.dropdown.close()},setVal:function(val){val=_.toStr(val),this.isActivated?this.input.setInputValue(val):(this.input.setQuery(val),this.input.setInputValue(val,!0)),this._setLanguageDirection()},getVal:function(){return this.input.getQuery()},destroy:function(){var $node,$input;this.input.destroy(),this.dropdown.destroy(),$node=this.$node,$input=$node.find(".tt-input"),_.each($input.data(attrsKey),function(val,key){_.isUndefined(val)?$input.removeAttr(key):$input.attr(key,val)}),$input.detach().removeData(attrsKey).removeClass("tt-input").insertAfter($node),$node.remove(),this.$node=null}}),Typeahead}();!function(){"use strict";var old=$.fn.typeahead,methods={initialize:function(o,datasets){return datasets=_.isArray(datasets)?datasets:[].slice.call(arguments,1),o=o||{},this.each(function(){var typeahead,$input=$(this);_.each(datasets,function(d){d.highlight=!!o.highlight}),typeahead=new Typeahead({input:$input,eventBus:new EventBus({el:$input}),withHint:!!_.isUndefined(o.hint)||!!o.hint,minLength:o.minLength,autoselect:o.autoselect,datasets:datasets}),$input.data("ttTypeahead",typeahead)})},open:function(){return this.each(function(){var typeahead=$(this);(typeahead=typeahead.data("ttTypeahead"))&&typeahead.open()})},close:function(){return this.each(function(){var typeahead=$(this);(typeahead=typeahead.data("ttTypeahead"))&&typeahead.close()})},val:function(newVal){return arguments.length?this.each(function(){var typeahead=$(this);(typeahead=typeahead.data("ttTypeahead"))&&typeahead.setVal(newVal)}):function(typeahead){var query;(typeahead=typeahead.data("ttTypeahead"))&&(query=typeahead.getVal());return query}(this.first())},destroy:function(){return this.each(function(){var typeahead,$input=$(this);(typeahead=$input.data("ttTypeahead"))&&(typeahead.destroy(),$input.removeData("ttTypeahead"))})}};$.fn.typeahead=function(method){var tts;return methods[method]&&"initialize"!==method?(tts=this.filter(function(){return!!$(this).data("ttTypeahead")}),methods[method].apply(tts,[].slice.call(arguments,1))):methods.initialize.apply(this,arguments)},$.fn.typeahead.noConflict=function(){return $.fn.typeahead=old,this}}()}(window.jQuery);